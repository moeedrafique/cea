{% extends 'base.html' %}
{% load static %}
<head>
    <title>{% block title %} {{ member.business_name }} Detail - CEA Portal {% endblock %}</title>
</head>
<body>
<main class="content">
    {% block content %}
    <div class="row">
        <div class="col-12 col-xl-12">
            <div class="card card-body border-0 shadow mb-4"><h2 class="h5 mb-4">General information</h2>
                <form id="memberForm" action="{% url 'view_member' member.id %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="full_name">Full Name پورا نام</label>
            <input class="form-control" name="full_name" value="{{ member.full_name }}" id="full_name" type="text" placeholder="Enter your full name" required>
        </div>
        <div class="col-md-4 mb-3">
            <label for="fathers_name">Father’s Name والد کا نام</label>
            <input class="form-control" name="father_name" value="{{ member.father_name }}" id="fathers_name" type="text" placeholder="Enter your father's name" required>
        </div>
        <div class="col-md-4 mb-3">
            <label for="birthday">Birthday تاریخ پیدائش</label>
            <div class="input-group">
                <span class="input-group-text">
                    <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                         xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                              d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                              clip-rule="evenodd"></path>
                    </svg>
                </span>
                <input data-datepicker="" name="dob" class="form-control datepicker-input" id="birthday" type="text"
                       placeholder="dd/mm/yyyy" value="{{ member.dob|date:'d/m/Y' }}" required>
            </div>
        </div>

    </div>
    <div class="row align-items-center">
        <div class="col-md-4 mb-3">
            <label for="cnic_number">CNIC Number شناختی کارڈ نمبر</label>
            <input class="form-control" name="cnic" value="{{member.cnic}}" id="cnic_number" type="text" placeholder="Enter your CNIC number" required>
        </div>
        <div class="col-md-4 mb-3">
            <label for="nic_type">Type of NIC شناختی کارڈ کی قسم</label>
            <select class="form-select mb-0" name="nic_type" id="nic_type" aria-label="Type of NIC">
                <option value="">Select NIC Type</option> <!-- Placeholder option -->
                <option value="cnic" {% if member.nic_type == 'cnic' %}selected{% endif %}>CNIC</option>
                <option value="nicop" {% if member.nic_type == 'nicop' %}selected{% endif %}>NICOP</option>
            </select>
        </div>
        <div class="col-md-4 mb-3">
            <label for="gender">Gender جنس</label>
            <select class="form-select mb-0" name="gender" id="gender" aria-label="Gender select example">
                <option value="">Gender</option>
                <option value="female" {% if member.gender == 'female' %}selected{% endif %}>Female</option>
                <option value="male" {% if member.gender == 'male' %}selected{% endif %}>Male</option>
            </select>
        </div>

    </div>
    <div class="row align-items-center">
                        <div class="col-md-6 mb-3"><label for="pri_mob">Primary Phone بنیادی فون نمبر</label>
                            <input name="pri_mob" value="{{ member.pri_mob }}" class="form-control" id="pri_mob"
                                                                                 type="text"
                                                                                 placeholder="Enter your Phone Number"
                                                                                 required="" name="pri_mob">
                        </div>
                        <div class="col-md-6 mb-3"><label for="sec_mob">Secondary Phone بنیادی فون نمبر</label>
                            <input name="sec_mob" value="{{ member.sec_mob }}" class="form-control" id="sec_mob"
                                                                                 type="text"
                                                                                 placeholder="Enter your secondary phone number"
                                                                                 required="" name="sec_mob">
                        </div>
                    </div>
    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="country_of_stay">Country of Stay قیام کا ملک</label>
            <select class="form-select mb-0" name="country_of_stay" id="country_of_stay" name="new_country_of_stay" aria-label="Country of Stay">
                <option value="" disabled>Country of Stay</option>
                {% for country in countries %}

                                    {% if country.name == member.country_of_stay.name %}
                                        <option value="{{ country.code }}" selected>{{ country.name }}</option>
                                    {% else %}
                                        <option value="{{ country.code }}">{{ country.name }}</option>
                                    {% endif %}

                {% endfor %}
            </select>
        </div>
        <div class="col-md-4 mb-3">
    <div class="form-group">
        <label for="dual_citizen">Dual Citizen دوہری شہریت</label>
        <div class="input-group">
            <select  class="form-select mb-0" id="dual_citizen" name="dual_citizen" aria-label="dual_citizen">
                <option value="" disabled >Dual Citizen</option>
                <option value="No"{% if member.dual_citizen == 'No' %}selected{% endif %}>No</option>
                <option value="Yes"{% if member.dual_citizen == 'Yes' %}selected{% endif %}>Yes</option>
            </select>
        </div>
    </div>
</div>
        <div class="col-md-4 mb-3">
    <div class="form-group">
        <label for="other_citizenship">Other Citizenship دوسری شہریت</label>
        <div class="input-group">
            <select  class="form-select mb-0" id="other_citizenship" name="other_citizenship" aria-label="other_citizenship">
                <option value=""   >NIL</option>
                {% for country in countries %}

                                    {% if country.name == member.other_citizenship.name %}
                                        <option value="{{ country.code }}" selected>{{ country.name }}</option>
                                    {% else %}
                                        <option value="{{ country.code }}">{{ country.name }}</option>
                                    {% endif %}

                {% endfor %}
            </select>
        </div>
    </div>
</div>

    </div>
    <div class="row align-items-center">
        <div class="col-md-6 mb-3">
            <label for="present_address">Present Address موجودہ پتہ</label>
            <textarea class="form-control" name="present_address" value="{{member.present_address}}" id="present_address" placeholder="Enter your present address" required>{{ member.present_address }}</textarea>
        </div>
        <div class="col-md-6 mb-3">
            <label for="permanent_address">Permanent Address مستقل پتہ</label>
            <textarea class="form-control" name="permanent_address" value="{{member.permanent_address}}" id="permanent_address" placeholder="Enter your permanent address" required>{{ member.permanent_address }}</textarea>
        </div>
    </div>

    <h2 class="h5 my-4">Business Information</h2>
    <div class="row">
        <div class="col-sm-9 mb-3">
            <label for="business_name">Business Name کاروبار کا نام</label>
            <input class="form-control" name="business_name" value="{{member.business_name}}" id="business_name" type="text" placeholder="Enter your business name" required>
        </div>
        <div class="col-sm-3 mb-3">
            <label for="designation">Designation عہدہ</label>
            <input class="form-control" name="designation" value="{{member.designation}}" id="designation" type="text" placeholder="Enter designation" required>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4 mb-3">
            <label for="no_of_employees">No of Employees ملازمین کی تعداد</label>
            <input class="form-control" name="employee_number" value="{{member.employee_number}}" id="no_of_employees" type="number" placeholder="Enter no of employees" required>
        </div>
        <div class="col-sm-4 mb-3">
            <label for="primary_landline">Primary Landline بنیادی لینڈ لائن</label>
            <input class="form-control" name="pri_land" value="{{member.pri_land}}" id="primary_landline" type="tel" placeholder="Enter primary landline" required>
        </div>
        <div class="col-sm-4 mb-3">
            <label for="secondary_landline">Secondary Landline سیکنڈری لینڈ لائن</label>
            <input class="form-control" name="sec_land" value="{{member.sec_land}}" id="secondary_landline" type="tel" placeholder="Enter secondary landline">
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4 mb-3">
            <label for="district">District ضلع</label>
            <select class="form-control" id="district" name="district" required>
                <option value="" disabled>District</option>
                {% for city in city %}
                    {% if city.id == member.district.id %}
                        <option value="{{ city.id }}" selected>{{ city.name }}</option>
                    {% else %}
                        <option value="{{ city.id }}">{{ city.name }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>

        <div class="col-sm-4 mb-3">
            <label for="tehsil">Tehsil تحصیل</label>
            <select class="form-control" id="tehsil" name="tehsil" required>
                <option value="" disabled>Tehsil</option>
                {% for city in tehsil %}
                    {% if city.id == member.tehsil.id %}
                        <option value="{{ city.id }}" selected>{{ city.name }}</option>
                    {% else %}
                        <option value="{{ city.id }}">{{ city.name }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-sm-4 mb-3">
            <label for="business_address">Business Address مکمل کاروباری پتہ</label>
            <textarea class="form-control" name="business_address" id="business_address" placeholder="Enter your business address" required>{{ member.business_address }}</textarea>
        </div>
    </div>
    <h2 class="h5 my-4">Payment Information</h2>
    <div class="row">
        <div class="col-sm-4 mb-3">
            <label for="fee_type">Fee Type فیس کی قسم</label>
            <input disabled class="form-control" name="fee_type" value="{{fee.fee_type|capfirst}}" id="fee_type" type="text">
        </div>
        <div class="col-sm-4 mb-3">
            <label for="submission_method">Submission Method جمع کرانے کا طریقہ</label>
            <input disabled class="form-control" name="employee_number" value="{{fee.submission_method|capfirst}}" id="submission_method" type="text">
        </div>
        <div class="col-sm-4 mb-3">
            <label for="transaction_id">Transaction ID ٹرانزیکشن</label>
            <input disabled class="form-control" name="employee_number" value="{{fee.transaction_id}}" id="transaction_id">
        </div>
<div class="col-sm-12 mb-3">
    <label for="transaction_id">Payment Details ادائیگی کی تفصیلات</label>

    <div class="d-flex flex-wrap justify-content-center">
        <div class="me-3">
            <strong>Bank Name:</strong> {{ fee.payment.bank_name }}
        </div>
        <div class="me-3">
            <strong>Title:</strong> {{ fee.payment.title }}
        </div>
        <div class="me-3">
            <strong>Account Number:</strong> {{ fee.payment.account_number }}
        </div>
        <div class="me-3">
            <strong>IBAN:</strong> {{ fee.payment.iban }}
        </div>
    </div>
</div>

    </div>
    <h2 class="h5 my-4">For Admins Only</h2>
    <hr>
    <div class="row">
        <div class="col-sm-4 mb-3">

<div class="form-check form-switch">
    <input class="form-check-input" name="approve_payment" type="checkbox" {% if fee.is_approved == True %}checked{% endif %} id="flexSwitchCheckPayment">
    <label class="form-check-label" for="flexSwitchCheckPayment">Approve Payment ادائیگی کو منظور کریں۔</label>
</div>
<div class="form-check form-switch">
    <input class="form-check-input" name="approve_member" type="checkbox"{% if member.is_approved %}checked{% endif %} id="flexSwitchCheckMember">
    <label class="form-check-label" for="flexSwitchCheckMember">Approve Member ممبر کو منظور کریں۔</label>
</div>


        </div>
    </div>
    <div class="mt-3">
        <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save all</button>
    </div>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('#memberForm');  // Assume the form has this ID
        form.addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent the default form submission

            const formData = new FormData(form);
            const xhr = new XMLHttpRequest();
            xhr.open('POST', form.action, true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Mark as AJAX request

            xhr.onload = function() {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);

                    if (response.success) {
                        // Show success message using SweetAlert
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: response.message,
                        }).then(() => {
                            // Optionally reload the page or redirect
                            window.location.href = '/member-dashboard/';
                        });
                    } else {
                        // Show error message using SweetAlert with error details
                        let errorMessage = '';
                        for (const [field, errors] of Object.entries(response.errors)) {
                            errorMessage += `${field}: ${errors.join(', ')}\n`;
                        }

                        Swal.fire({
                            icon: 'error',
                            title: 'Form Submission Failed',
                            text: 'Please check the errors below:',
                            footer: `<pre style="text-align: left;">${errorMessage}</pre>`,
                        });
                    }
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Request Failed',
                        text: `Server responded with status: ${xhr.status}`,
                    });
                }
            };

            xhr.onerror = function() {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred during the request.',
                });
            };

            xhr.send(formData);
        });
    });
</script>
            </div>
        </div>
    </div>
    {% endblock %}
</main>

</body>