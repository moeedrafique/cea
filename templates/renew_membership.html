{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
<head>
    <title>{% block title %} Renewal Application - CEA Portal {% endblock %}</title>
</head>
<body>
<main class="content">
    {% block content %}
    <div class="row">
        <div class="col-12 col-xl-8">
            <div class="card card-body border-0 shadow mb-4"><h2 class="h5 mb-4">Personal Information</h2>
                <form id="renewMembershipForm" method="POST">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div><label for="full_name">Full Name پورا نام</label>
<input disabled class="form-control" id="full_name" name="new_full_name" type="text" placeholder="Enter your full name" value="{{member.full_name}}" required=""/>
</div>
                            </div>
                                                        <script>
document.addEventListener("DOMContentLoaded", function() {
    // Make sure all elements are available before adding event listeners

    // Make "Full Name" editable
<!--    var fullNameInput = document.getElementById('full_name');-->
<!--    var editIcon = document.getElementById('edit_icon');-->
<!--    if (editIcon && fullNameInput) {-->
<!--        editIcon.addEventListener('click', function() {-->
<!--            fullNameInput.disabled = false;-->
<!--            fullNameInput.focus();  // Focus on the input field-->
<!--        });-->
<!--    }-->

    // Make "Country of Stay" editable
    var countryInput = document.getElementById('country_of_stay');
    var editCountryIcon = document.getElementById('edit_country_icon');
    if (editCountryIcon && countryInput) {
        editCountryIcon.addEventListener('click', function() {
            countryInput.disabled = false;
            countryInput.focus();  // Focus on the input field
        });
    }

    // Make "Present Address" editable
    var presentAddress = document.getElementById('present_address');
    var editPresentAddressIcon = document.getElementById('edit_present_address_icon');
    if (editPresentAddressIcon && presentAddress) {
        editPresentAddressIcon.addEventListener('click', function() {
            presentAddress.disabled = false;
            presentAddress.focus();  // Focus on the textarea
        });
    }

    // Make "Permanent Address" editable
    var permanentAddress = document.getElementById('permanent_address');
    var editPermanentAddressIcon = document.getElementById('edit_permanent_address_icon');
    if (editPermanentAddressIcon && permanentAddress) {
        editPermanentAddressIcon.addEventListener('click', function() {
            permanentAddress.disabled = false;
            permanentAddress.focus();  // Focus on the textarea
        });
    }

    // Make "Secondary Landline" editable
    var secondaryLandlineInput = document.getElementById('secondary_landline');
    var editSecondaryLandlineIcon = document.getElementById('edit_secondary_landline_icon');
    if (editSecondaryLandlineIcon && secondaryLandlineInput) {
        editSecondaryLandlineIcon.addEventListener('click', function() {
            secondaryLandlineInput.disabled = false;
            secondaryLandlineInput.focus();  // Focus on the input field
        });
    }

    // Make "Dual Citizen" editable
    var dualCitizenSelect = document.getElementById('new_dual_citizen');
    var editDualCitizenIcon = document.getElementById('edit_dual_citizen_icon');

    if (editDualCitizenIcon && dualCitizenSelect) {
        editDualCitizenIcon.addEventListener('click', function() {
            dualCitizenSelect.disabled = false;  // Enable the select dropdown
            dualCitizenSelect.focus();  // Focus on the dropdown
        });
    }
    // Make "Other Citizenship" editable
    var otherCitizenshipSelect = document.getElementById('new_other_citizenship');
    var editOtherCitizenshipIcon = document.getElementById('edit_other_citizenship_icon');

    if (editOtherCitizenshipIcon && otherCitizenshipSelect) {
        editOtherCitizenshipIcon.addEventListener('click', function() {
            otherCitizenshipSelect.disabled = false;  // Enable the select dropdown
            otherCitizenshipSelect.focus();  // Focus on the dropdown
        });
    }


    // Make "Primary Landline" editable
    var primaryLandlineInput = document.getElementById('new_pri_land');
    var editPrimaryLandlineIcon = document.getElementById('edit_primary_landline_icon');

    if (editPrimaryLandlineIcon && primaryLandlineInput) {
        editPrimaryLandlineIcon.addEventListener('click', function() {
            primaryLandlineInput.disabled = false;  // Enable the input field
            primaryLandlineInput.focus();  // Focus on the input field so the user can start typing
        });
    }

});
                            </script>
                        <div class="col-md-4 mb-3">
                            <div><label for="fathers_name">Father’s Name والد کا نام</label> <input disabled class="form-control" id="fathers_name"
                                                                                 type="text"
                                                                                 placeholder="Enter your father name"
                                                                                 required="" name="new_father_name" value="{{member.father_name}}"></div>
                        </div>
                        <div class="col-md-4 mb-3"><label for="birthday">Birthday تاریخ پیدائش</label>
                            <div class="input-group"><span class="input-group-text"><svg class="icon icon-xs"
                                                                                         fill="currentColor"
                                                                                         viewBox="0 0 20 20"
                                                                                         xmlns="http://www.w3.org/2000/svg"><path
                                    fill-rule="evenodd"
                                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                                    clip-rule="evenodd"></path></svg> </span><input disabled data-datepicker=""
                                                                                    class="form-control datepicker-input"
                                                                                    id="birthday" type="text"
                                                                                    placeholder="dd/mm/yyyy"
                                                                                    required="" name="new_dob" value="{{ member.dob|date:'d/m/Y' }}"></div>
                        </div>
                    </div>
                    <div class="row align-items-center">
                        <div class="col-md-4 mb-3">
                            <div><label for="last_name">CNIC Number شناختی کارڈ نمبر</label> <input disabled class="form-control" id="cnic"
                                                                                 type="text"
                                                                                 placeholder="Enter your CNIC number"
                                                                                 required="" name="new_cnic" value="{{member.cnic}}"></div>
                        </div>
                        <div class="col-md-4 mb-3"><label for="nic_type">Type of NIC شناختی کارڈ کی قسم</label> <select name="new_nic_type" disabled class="form-select mb-0" id="nic_type" aria-label="Type of NIC">
                            <option value="">Select NIC Type</option> <!-- Placeholder option -->
                            <option value="cnic" {% if member.nic_type == 'cnic' %}selected{% endif %}>CNIC</option>
                            <option value="nicop" {% if member.nic_type == 'nicop' %}selected{% endif %}>NICOP</option>
                        </select></div>
                        <div class="col-md-4 mb-3"><label for="gender">Gender جنس</label> <select name="new_gender" disabled class="form-select mb-0" id="gender" aria-label="Gender select example">
                            <option value="">Gender</option>
                            <option value="female" {% if member.gender == 'female' %}selected{% endif %}>Female</option>
                            <option value="male" {% if member.gender == 'male' %}selected{% endif %}>Male</option>
                        </select>
                        </div>
                    </div>
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3"><label for="gender">Primary Phone بنیادی فون نمبر</label>
                            <input disabled class="form-control" id="pri_mob"
                                                                                 type="text"
                                                                                 placeholder="Enter your Phone Number"
                                                                                 required="" name="new_cnic" value="{{member.pri_mob}}">
                        </div>
                        <div class="col-md-6 mb-3"><label for="gender">Secondary Phone بنیادی فون نمبر</label>
                            <input disabled class="form-control" id="pri_mob"
                                                                                 type="text"
                                                                                 placeholder="Enter your Phone Number"
                                                                                 required="" name="new_cnic" value="{{member.pri_mob}}">
                        </div>
                    </div>
                    <div class="row align-items-center">
                        <div class="col-md-4 mb-3">
    <div class="form-group">
        <label for="country_of_stay">Country of Stay قیام کا ملک</label>
        <div class="input-group">
            <select disabled class="form-select mb-0" id="country_of_stay" name="new_country_of_stay" aria-label="Country of Stay">
                <option value="" disabled>Country of Stay</option>
                {% for country in countries %}

                                    {% if country.name == member.country_of_stay.name %}
                                        <option value="{{ country.code }}" selected>{{ country.name }}</option>
                                    {% else %}
                                        <option value="{{ country.code }}">{{ country.name }}</option>
                                    {% endif %}

                {% endfor %}
            </select>
            <span class="input-group-text">
                <i class="fas fa-edit" id="edit_country_icon" style="cursor: pointer;"></i>
            </span>
        </div>
    </div>
</div>
                        <div class="col-md-4 mb-3">
    <div class="form-group">
        <label for="new_dual_citizen">Dual Citizen دوہری شہریت</label>
        <div class="input-group">
            <select disabled class="form-select mb-0" id="new_dual_citizen" name="new_dual_citizen" aria-label="Country of Stay">
                <option value="" disabled>Dual Citizen</option>
                <option value="No" {% if member.dual_citizen == "No" %}selected{% endif %}>No</option>
                <option value="Yes" {% if member.dual_citizen == "Yes" %}selected{% endif %}>Yes</option>
            </select>
            <span class="input-group-text">
                <i class="fas fa-edit" id="edit_dual_citizen_icon" style="cursor: pointer;"></i>
            </span>
        </div>
    </div>
</div>
                        <div class="col-md-4 mb-3">
    <div class="form-group">
        <label for="new_other_citizenship">Other Citizenship دوسری شہریت</label>
        <div class="input-group">
            <select disabled class="form-select mb-0" id="new_other_citizenship" name="new_other_citizenship" aria-label="Country of Stay">
                <option value="" disabled>Other Citizenship</option>
                {% for country in countries %}

                                    {% if country.name == member.other_citizenship.name %}
                                        <option value="{{ country.code }}" selected>{{ country.name }}</option>
                                    {% else %}
                                        <option value="">NIL</option>
                                    {% endif %}

                {% endfor %}
            </select>
            <span class="input-group-text">
                <i class="fas fa-edit" id="edit_other_citizenship_icon" style="cursor: pointer;"></i>
            </span>
        </div>
    </div>
</div>



                    </div>
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3">
    <div class="form-group">
        <label for="present_address">Present Address موجودہ پتہ</label>
        <div class="input-group">
            <textarea disabled class="form-control" id="present_address" name="new_present_address" placeholder="Enter your present address" required="">{{ member.present_address }}</textarea>
            <span class="input-group-text">
                <i class="fas fa-edit" id="edit_present_address_icon" style="cursor: pointer;"></i>
            </span>
        </div>
    </div>
</div>

<div class="col-md-6 mb-3">
    <div class="form-group">
        <label for="permanent_address">Permanent Address مستقل پتہ</label>
        <div class="input-group">
            <textarea disabled class="form-control" id="permanent_address" name="new_permanent_address" placeholder="Enter your permanent address" required="">{{ member.permanent_address }}</textarea>
            <span class="input-group-text">
                <i class="fas fa-edit" id="edit_permanent_address_icon" style="cursor: pointer;"></i>
            </span>
        </div>
    </div>
</div>
                    </div>
                    <h2 class="h5 my-4">Business Information</h2>
                    <div class="row">
                        <div class="col-sm-9 mb-3">
                            <div class="form-group"><label for="business_name">Business Name کاروبار کا نام</label> <input disabled class="form-control"
                                                                                                id="business_name" type="text"
                                                                                                placeholder="Enter your business name"
                                                                                                required="" name="new_business_name"  value="{{member.business_name}}"></div>
                        </div>
                        <div class="col-sm-3 mb-3">
                            <div class="form-group"><label for="designation">Designation عہدہ</label>
                                <input disabled class="form-control" value="{{member.designation}}" name="new_designation" id="designation" type="text" placeholder="Enter designation" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 mb-3">
                            <div class="form-group"><label for="no_of_employees">No of Employees ملازمین کی تعداد</label>
                                <input disabled class="form-control" value="{{member.employee_number}}" name="new_employee_number" id="no_of_employees" type="number" placeholder="Enter no of employees" required>
                            </div>
                        </div>
                       <div class="col-sm-4 mb-3">
                            <label for="new_pri_land">Primary Landline بنیادی لینڈ لائن</label>
                            <div class="input-group">
                                    <input disabled class="form-control" id="new_pri_land" value="{{member.pri_land}}" name="new_pri_land" type="tel" placeholder="Enter primary landline" required="">
                                <span class="input-group-text">
                                    <i class="fas fa-edit" id="edit_primary_landline_icon" style="cursor: pointer;"></i>
                                </span>
                            </div>
                        </div>

                        <div class="col-sm-4">
                            <div class="form-group">
                                <label for="secondary_landline">Second Landline سیکنڈری لینڈ لائن</label>
                                    <div class="input-group">
                                        <input disabled class="form-control" name="new_sec_land" id="secondary_landline" value="{{member.sec_land}}" type="tel" placeholder="Enter your secondary landline" required="">
                                        <span class="input-group-text">
                                            <i class="fas fa-edit" id="edit_secondary_landline_icon" style="cursor: pointer;"></i>
                                        </span>
                                    </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-sm-4 mb-3">
                            <div class="form-group"><label for="new_district">District ضلع</label>
                            <select disabled class="form-select" id="new_district" name="new_district" required>
                                <option value="" disabled>District</option>
                                {% for city in city %}
                                    {% if city.id == member.district.id %}
                                        <option value="{{ city.id }}" selected>{{ city.name }}</option>
                                    {% else %}
                                        <option value="{{ city.id }}">{{ city.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            </div>
                        </div>
                        <div class="col-sm-4 mb-3"><label for="new_tehsil">Tehsil تحصیل</label>
                            <div class="choices" data-type="select-one" role="combobox" tabindex="0"
                                 aria-autocomplete="list" aria-haspopup="true" aria-expanded="false" dir="ltr">
                                <div class="choices__inner">
                                <select disabled class="form-select" id="new_tehsil" name="new_tehsil" required>
                                    <option value="" disabled>Tehsil</option>
                                    {% for city in tehsil %}
                                        {% if city.id == member.tehsil.id %}
                                            <option value="{{ city.id }}" selected>{{ city.name }}</option>
                                        {% else %}
                                            <option value="{{ city.id }}">{{ city.name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group"><label for="zip">Business Address مکمل کاروباری پتہ</label> <textarea disabled class="form-control" id="zip"
                                                                                        type="tel" placeholder="ZIP"
                                                                                                        required="">{{member.business_address}}</textarea></div>
                        </div>
                    </div>

                    <h2 class="h5 my-4">Payment Information</h2>
<div class="col-md-12 mb-3 d-flex align-items-center">
    <label for="submission_method" class="me-2 flex-shrink-0">Submission Method جمع کرانے کا طریقہ</label>
    {% render_field form.submission_method class="form-select mb-0 flex-grow-1" placeholder=form.submission_method.label %}
</div>

                    <!-- Bank Transfer Info Box (hidden by default) -->
<!-- Bank Transfer Info Box (hidden by default) -->
<div id="bank-transfer-info" class="bank-info-container mb-3" style="display: none;">
    <div class="bank-info-title">Bank Transfer Details بینک ٹرانسفر کی تفصیلات</div>

    <!-- Two-column layout for two bank details -->
    <div class="bank-info-grid">
        <div class="transaction-info">
            <p>Please transfer <strong>PKR 7,500</strong> to one of the accounts listed below and make sure to save the transaction ID or reference number, as it will be required when filling out the form.
            <br>برائے کرم نیچے دیے گئے اکاؤنٹس میں سے کسی ایک میں ساڑھے سات ہزار روپے منتقل کر دیں اور ٹرانزیکشن ائی ڈی یا ریفرنس نمبر کو محفوظ کر لیں کیونکہ فارم کو مکمل کرتے ہوئے اس کی ضرورت ہوگی۔</p>
        </div>

        <!-- Bank 1 Details -->
        {% for payment in payment_details %}
        <div class="bank-info-box" onclick="selectBank('bank_choice_{{ forloop.counter }}')">
            <input type="radio" name="payment" id="bank_choice_{{ forloop.counter }}" value="{{ payment.id }}" class="bank-radio" style="display: none;" {% if forloop.first %} checked {% endif %}>
            {% if payment.bank_name == 'UNITED BANK LIMITED - UBL' %}
            <img src="{% static '/assets/img/ubl_logo.png' %}"/>
            {% endif %}
            <h5 class="bank-name">{{ payment.bank_name }} <br>{% if payment.bank_name == 'UNITED BANK LIMITED - UBL' %} یونائیٹڈ بینک لمیٹڈ {% endif %}</h5>
            <div class="bank-info-item">
                <span class="label">Account Title:</span>
                <span id="bank_name_display_a">{{ payment.title }}</span>
            </div>
            <div class="bank-info-item">
                <span class="label">Account Number:</span>
                <span id="account_number_display_a">{{ payment.account_number }}</span>
            </div>
            <div class="bank-info-item">
                <span class="label">IBAN:</span>
                <span id="branch_code_display_a">{{ payment.iban }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

                    <style>
  .bank-info-container {
    padding: 15px;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    margin-top: 15px;
}

.bank-info-title {
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 10px;
    text-align: center;
}

.bank-info-grid {
    display: flex;
    justify-content: space-between; /* Space between boxes */
    flex-wrap: wrap; /* Wrap if necessary */
}
.transaction-info {
    background-color: #f9f9f9; /* Light background color */
    border: 1px solid #ddd; /* Border around the message */
    padding: 15px; /* Padding inside the message box */
    margin-bottom: 20px; /* Space below the message box */
    border-radius: 5px; /* Rounded corners */
    text-align: center; /* Centered text */
}

.bank-info-box {
    border: 1px solid #ddd; /* Border around each box */
    padding: 15px; /* Padding inside the box */
    flex: 1; /* Allow boxes to grow equally */
    margin: 10px; /* Space between boxes */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow for depth */
    max-width: 48%; /* Limit box width */
}

.bank-info-box img {
    display: block; /* Center the image */
    margin: 0 auto 10px; /* Center the image and add margin below */
    max-width: 100px; /* Limit logo size */
}

.label {
    font-weight: bold; /* Make labels bold */
}
#bank-transfer-info,
#transaction-id-field {
    transition: opacity 0.3s ease-in-out;
}
.bank-name {
    text-align: center; /* Center the bank name */
    margin-bottom: 10px; /* Space below bank name */
}

.bank-info-item {
    padding: 8px 0;
    font-size: 14px;
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid #dee2e6;
}

.bank-info-item:last-child {
    border-bottom: none; /* Remove border for the last item */
}

.bank-info-item .label {
    font-weight: bold;
    color: #495057;
}

.bank-info-item span {
    color: #212529;
}
    .bank-info-box {
        cursor: pointer; /* Indicate that the box is clickable */
        border: 1px solid #ddd; /* Default border */
        padding: 15px; /* Padding inside the box */
    }
    .bank-info-box.selected {
        border: 2px solid #007bff; /* Highlight selected bank */
    }
                    </style>

<div class="col-md-12 mb-3 d-flex align-items-center">
    <label for="amount_submitted" class="me-2 flex-shrink-0">Amount submitted جمع کرائی گئی رقم</label>
    {% render_field form.amount_submitted class="form-control mb-0 flex-grow-1" placeholder=form.amount_submitted.label %}
</div>

<!-- Transaction ID Field (Initially hidden) -->
<div id="transaction-id-field" class="col-md-12 mb-3 d-flex align-items-center" style="display: none!important;">
    <label for="transaction_id" class="me-2 flex-shrink-0">Transaction ID ٹرانزیکشن ائی ڈی</label>
    {% render_field form.transaction_id class="form-control mb-0 flex-grow-1" placeholder=form.transaction_id.label %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const submissionMethodSelect = document.getElementById('id_submission_method');
    const bankInfoBox = document.getElementById('bank-transfer-info');
    const transactionIdField = document.getElementById('transaction-id-field'); // Transaction ID field
    const transactionIdInput = document.getElementById('id_transaction_id'); // Transaction ID input element

    // Function to toggle the display of bank transfer info and transaction ID field
    function toggleBankInfo() {
        if (submissionMethodSelect.value === 'bank_transfer') {
            bankInfoBox.style.setProperty('display', 'block', 'important');
            transactionIdField.style.setProperty('display', 'flex', 'important'); // Show transaction ID field
            transactionIdInput.setAttribute('required', 'required'); // Make the Transaction ID required
            transactionIdInput.focus();  // Focus on the input field
            // Activate the first bank by default
            selectBank('bank_choice_1');
        } else {
            bankInfoBox.style.setProperty('display', 'none', 'important');
            transactionIdField.style.setProperty('display', 'none', 'important'); // Hide transaction ID field
            transactionIdInput.removeAttribute('required'); // Remove required attribute for non-bank transfer methods
        }
    }

    // Initial check when the page loads
    toggleBankInfo();

    // Add event listener to handle the selection change
    submissionMethodSelect.addEventListener('change', toggleBankInfo);
});

// Function to highlight the selected bank
function selectBank(selectedId) {
    const allRadios = document.querySelectorAll('.bank-radio');
    const allBankBoxes = document.querySelectorAll('.bank-info-box');

    allRadios.forEach((radio, index) => {
        const bankBox = allBankBoxes[index];
        if (radio.id === selectedId) {
            radio.checked = true; // Check the selected radio button
            bankBox.classList.add('selected'); // Highlight selected bank
        } else {
            bankBox.classList.remove('selected'); // Remove highlight for unselected banks
        }
    });
}


</script>

                    <div class="mt-3">
                        <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Submit Application درخواست جمع کروائیں۔</button>
                    </div>
                </form>
                <script>
        document.getElementById('renewMembershipForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the form from submitting the traditional way

            const formData = new FormData(this); // Collect form data

            // Submit the form data via AJAX
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest' // Indicate AJAX request
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: data.message,
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.message,
                    });
                }
            })
            .catch(error => {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An unexpected error occurred.',
                });
            });
        });
    </script>
            </div>
        </div>
        <div class="col-12 col-xl-4">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card shadow border-0 text-center p-0">
                        <div class="profile-cover rounded-top" data-background="{% static '/assets/img/brand/CEA.png' %}"
                             style="background: url({% static '/assets/img/brand/CEA.png' %});"></div>
                        <div class="card-body pb-5">
                            {% if member.image %}
                            <img src="../assets/img/team/profile-picture-1.jpg" class="avatar-xl rounded-circle mx-auto mt-n7 mb-4" alt="{{member.full_name}}">
                                                    {% else %}
                            <img src="{% static '/assets/img/default_pic.png' %}" class="avatar-xl rounded-circle mx-auto mt-n7 mb-4" alt="{{member.full_name}}">
                            {% endif %}
                            <h4 class="h3">{{member.full_name}}</h4><h5
                                class="fw-normal">{{member.business_name}}</h5>
                            <p class="text-gray mb-4">{{ member.cnic }}</p>
                            <a class="btn btn-sm btn-secondary" href="#">Update Picture</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
</main>

</body>